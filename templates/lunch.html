<!DOCTYPE html>
<html lang="en">
{% from 'macros.html' import head, nav, importJs, bodyPaddingNav %}

{{ head('Block ' + block|string + ', Lunch ' + number|string, True) }}
<body id="body" class="bg-primary">

{{ nav(True, "/roster", handle) }}
{{ bodyPaddingNav() }}

<section class="hero is-primary section pushed">
    <div class="hero-body">
        <div class="container">
            <h1 class="title overridden-white is-1">
                Block {{ block }}, Lunch {{ number }}
            </h1>
            <h2 class="subtitle overridden-white is-3">
                {{ roster|length }} student(s)
            </h2>
            {% if period in lunch_periods %}
                {% if lunch_number != none %}
                    <h3 class="title overridden-white is-5">Lunch {{ lunch_number }}</h3>
                {% else %}
                    {% if user_in_class %}
                        <h3 class="title overridden-white is-5">No lunch set for this class, why not <a
                                href="/update#teacher-notif-{{ period }}">add it?</a></h3>
                    {% else %}
                        <h3 class="title overridden-white is-5">No lunch set for this class.</h3>
                    {% endif %}
                {% endif %}
            {% endif %}
        </div>
    </div>
</section>
<section class="section pushed">
    <div class="box" id="box" style="margin: 0 auto; max-width: 390px; padding: 1.25rem 0; ">
        <form style="margin: 0 1.25rem 1.5rem 1.25rem;">
            <script type="text/javascript">
                function filterStudents() {
                    let input, filter;
                    input = document.getElementById('search');
                    filter = input.value.toUpperCase();

                    let noResultsText = document.getElementById('no-results');
                    noResultsText.style.display = "none";

                    let names = document.getElementsByClassName('name');
                    let handles = document.getElementsByClassName('handle');

                    if (filter.length > 0) {


                        let hitCounter = filterFromLists(names, handles, filter); //

                        if (hitCounter === 0 && filter.length > 0) {
                            if (hitCounter === 0 && filter.length > 0)
                                noResultsText.style.display = "flex";
                            else
                                noResultsText.style.display = "none";
                        }
                    } else {
                        Array.prototype.forEach.call(names, (name) => {
                            name.parentElement.style.display = "flex";
                        });
                        noResultsText.style.display = "none";
                    }


                }

                // handleList must have the same length as nameList
                function filterFromLists(nameList, handleList, filter) {
                    let hitCounter = 0;
                    for (let i = 0; i < nameList.length; i++) {
                        if ((nameList[i].innerHTML.toUpperCase().indexOf(filter) > -1 || handleList[i].innerHTML.toUpperCase().indexOf(filter) > -1) && filter !== '') {
                            nameList[i].parentElement.style.display = "flex";
                            hitCounter++;
                        } else {
                            nameList[i].parentElement.style.display = "none";
                        }
                    }

                    return hitCounter;
                }
            </script>
            <input class="input is-large" type="text" id="search" placeholder="Search a name or handle here..."
                   required style="font-size: 18px;" onkeyup="filterStudents()">
        </form>
        <table class="table is-fullwidth is-size-4" id="table" style="min-width: 100%">
            <tbody>
            {% for name, rhandle in roster %}
                <tr class="{{ 'is-selected' if handle == rhandle }} lunch-row">
                    <td class="name">{{ name }}</td>
                    <td class="handle">{{ rhandle }}</td>
                    <td class="roster-link"
                        style="{{ 'border: none!important;' if loop.index == roster|length else '' }}">
                        <a class="button {{ 'is-outlined' if handle != rhandle }} is-primary is-medium"
                           href="/user/{{ rhandle }}">View Schedule</a>
                    </td>
                </tr>
            {% endfor %}
            <tr class="lunch-row is-size-2" style="display: none;" id="no-results">
                <td class="name">No students found</td>
            </tr>
            </tbody>
        </table>
    </div>
</section>

<style>

    table {
        margin: 0 auto;
        max-width: 25%;
        border-radius: 10px;
    }

    .roster-link {
        border-bottom: 1px solid #bdbdbd !important;
    }

    tr td {
        flex: 1;
        text-align: center;
        color: #009688;
        border: none !important;
    }

    .handle {
        margin-top: -1rem;
    }

    tr {
        display: flex;
        flex-direction: column;
    }

    .name {
        font-size: 18px;
        color: #03A9F4;
        font-weight: bold;
    }

</style>
<script type="text/javascript">
    function formResize() {
        $("#box").css('max-width', $('#table').innerWidth());
    }

    $(document).ready(() => {
        formResize();
    });

    $(window).resize(() => {
        formResize();
        if ($(window).width() <= 480) {
            $('.roster-link').each((indx, td) => {
                let button = td.getElementsByTagName('a')[0];
                button.innerHTML = "Schedule"
            });
        } else {
            $('.roster-link').each((indx, td) => {
                let button = td.getElementsByTagName('a')[0];
                button.innerHTML = "View Schedule"
            });
        }
    });
</script>
{{ importJs() }}

</body>
</html>