<!DOCTYPE html>
<html lang="en">
{% from 'macros.html' import head %}

{{ head('Assign Lunches', True) }}
<body id="body" class="bg-primary">

<section class="hero is-primary section pushed">
    <div class="hero-body">
        <div class="container">
            <form id="form">
                <label for="block-chooser" style="font-size: 2rem;">Choose a block: </label>
                <select id="block-chooser" form="form" name="block" style="font-size: 1.5rem;"
                        onchange="setLunchForm()">
                    {% for block in blocks %}
                        <option value="{{ block }}" id="lunch-option-{{ block }}">{{ block }}</option>
                    {% endfor %}
                </select>
                <br><br>
                <label for="lunch-chooser" style="font-size: 2rem;">Choose a lunch: </label>
                <select id="lunch-chooser" form="form" name="block" style="font-size: 1.5rem;"
                        onchange="setLunchForm()">
                    {% for lunch in lunch_numbers %}
                        <option value="{{ lunch }}" id="lunch-number-{{ lunch }}">{{ lunch }}</option>
                    {% endfor %}
                </select>
            </form>
            <br>
            <br>
            <form method="post" name="lunch" id="hidden-form">
                <input type="hidden" name="block" id="hidden-block">
                <input type="hidden" name="number" id="hidden-lunch">
                <input type="hidden" name="handles" id="hidden-handles" value="[]">

                <div class="overridden-white" id="list"></div>
                <br>
                <br>
                <input type="submit" value="Submit lunch" style="font-size: 24px;">
            </form>
        </div>
    </div>
</section>
<section class="section pushed">
    <div class="box" id="box" style="margin: 0 auto; max-width: 75%; padding: 1.25rem; ">
        <form style="margin: 0 1.25rem 1.5rem 1.25rem;">
            <script type="text/javascript">
                function filterStudents() {
                    let input, filter;
                    input = document.getElementById('search');
                    filter = input.value.toUpperCase();

                    let noResultsText = document.getElementById('no-results');
                    noResultsText.style.display = "none";

                    let names = document.getElementsByClassName('name');
                    let handles = document.getElementsByClassName('handle');

                    if (filter.length > 0) {
                        let hitCounter = filterFromLists(names, handles, filter); //

                        if (hitCounter === 0 && filter.length > 0) {
                            noResultsText.style.display = "flex";
                            Array.prototype.forEach.call(document.getElementsByClassName('column'), (col) => {
                                $(col).hide();
                            });
                        }
                        else {
                            noResultsText.style.display = "none";
                            Array.prototype.forEach.call(document.getElementsByClassName('column'), (col) => {
                                $(col).show();
                            });
                        }
                    } else {
                        Array.prototype.forEach.call(names, (name) => {
                            name.parentElement.style.display = "flex";
                        });
                        noResultsText.style.display = "none";
                    }


                }

                // handleList must have the same length as nameList
                function filterFromLists(nameList, handleList, filter) {
                    let hitCounter = 0;
                    for (let i = 0; i < nameList.length; i++) {
                        if ((nameList[i].innerHTML.toUpperCase().indexOf(filter) > -1 || handleList[i].innerHTML.toUpperCase().indexOf(filter) > -1) && filter !== '') {
                            nameList[i].parentElement.style.display = "flex";
                            hitCounter++;
                        } else {
                            nameList[i].parentElement.style.display = "none";
                        }
                    }

                    return hitCounter;
                }
            </script>
            <input class="input is-large" type="text" id="search" placeholder="Search a name or handle here..."
                   required style="font-size: 18px;" onkeyup="filterStudents()">
        </form>
        <div class="columns">
            <div class="column is-one-third">
                {% for name, rhandle in students %}
                    {% if loop.index == (loop|length / 3)|round|int + 1 or loop.index == (loop|length / 3)|round|int * 2 + 1 %}
                        </div>
                        <div class="column is-one-third">
                    {% endif %}
                    <div class="lunch-row" id='{{ rhandle|replace("/'/g",'&apos;') }}'>
                        <h1 class="name">{{ name }}</h1>
                        <h1 class="handle">{{ rhandle }}</h1>
                        <p class="roster-link"
                           style=" text-align: center;">
                            <a class="button is-primary is-medium" onclick="addToLunch(&quot;{{ rhandle }}&quot;)">Select
                                student</a>
                        </p>
                    </div>
                {% endfor %}
                </div>
        </div>
        <div class="lunch-row is-size-2" style="display: none; margin: 0; text-align: center; font-size: 1.25rem;"
             id="no-results">
            <p>No students found</p>
        </div>
    </div>
</section>

<style>
    .lunch-row h1 {
        flex: 1;
        text-align: center;
        color: #009688;
        border: none !important;
    }

    .handle {
        margin: -0.3rem 0;
        font-size: 14px;
    }

    .lunch-row {
        display: flex;
        flex-direction: column;
        margin: 0 0.75rem;
    }

    .name, #no-results {
        font-size: 18px;
        color: #03A9F4;
        font-weight: bold;
        margin-top: 1rem;
    }

    .column {
        border-right: 1px solid #bdbdbd !important;
        padding-left: 0;
        padding-right: 0;
    }

    .column:last-of-type {
        border: none !important;
    }

    .lunch-row.is-selected {
        margin: 0;
    }

    .is-selected {
        background-color: #03A9F4;
    }

    .is-selected h1 {
        color: white !important;
    }

    @media screen and (max-width: 1000px) {
        .name {
            font-size: 14px;
        }

        .handle {
            font-size: 10px;
        }

        .button { /* Turn it from is-medium to is-small */
            border-radius: 2px;
            font-size: .75rem !important;
        }
    }

    @media screen and (max-width: 750px) {
        .columns {
            flex-direction: column;
        }

        .name {
            font-size: 18px;
        }

        .handle {
            font-size: 14px;
        }

        .button {
            font-size: 1.25rem !important;
        }

        .column {
            border-right: none !important;
        }

        #box {
            padding: 1.25rem 0 !important;
        }
    }

    @media screen and (max-width: 600px) {
        #no-results p {
            font-size: 18px !important;
        }
    }

    @media screen and (max-width: 470px) {
        #search {
            font-size: 14px !important;
        }
    }

    @media screen and (max-width: 450px) {
        .name {
            font-size: 14px;
        }

        .handle {
            font-size: 10px;
        }

        .title.is-1 {
            font-size: 1.5rem;
        }

        .subtitle.is-3 {
            font-size: 1rem;
        }

        #search {
            font-size: 11px !important;
        }
    }
</style>
<script type="text/javascript">
    let selectedHandles = [];

    function setLunchForm() {
        document.getElementById('hidden-block').value = document.getElementById('block-chooser').value;
        document.getElementById('hidden-lunch').value = document.getElementById('lunch-chooser').value;
    }

    function addToLunch(handle) {
        selectedHandles.push(handle);
        document.getElementById('hidden-handles').value = selectedHandles.join(",");
        document.getElementById('list').innerHTML = "Selected students:<ul style=\"list-style-type: disc!important;\"><li>" + selectedHandles.join("</li><li>") + "</ul>";
        $("#" + handle.replace(/'/g,"&apos;")).remove();
    }

    setLunchForm();

    function buttons() {
        if ($(window).width() <= 480) {
            $('.roster-link').each((indx, td) => {
                let button = td.getElementsByTagName('a')[0];
                button.innerHTML = "Select"
            });
        } else {
            $('.roster-link').each((indx, td) => {
                let button = td.getElementsByTagName('a')[0];
                button.innerHTML = "Select Student"
            });
        }
    }

    buttons();

    $(window).resize(() => {
        buttons();
    });
</script>

</body>
</html>